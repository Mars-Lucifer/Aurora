# Aurora

Голосовой ассисент для вашего ПК, может выполнять большинство стандартных функций которыми вы пользуетесь каждый день для облегчения вашего взаимодействия с компьютером. На данный момент весь функционал Авроры ограничивается созданием окна и иконкой в трее

[Требования](#требования)

[Установка и запуск](#установка-и-запуск)

[Документация](#документация)

# Требования

*Аврора работает стабильно только на Windows 10/11*

Для запуска требуется:
- Поддерживаемая ОС (Windows 10/11)
- Node.js
- Python 3.0+
- Библиотеки Python
  - asyncio

# Установка и запуск

![Aurora](/style/img/Test1.jpg)

Для установки откройте терминал в нужной директории и впишите команду:

`git clone https://github.com/Mars-Lucifer/Aurora`

После этого перейдите в директорию Aurora и установите нужные зависимости командой:

`npm i`

После выполнения этих действий вы можете запустить ассистента командой:

`npm start`

# Документация

Аврора - это приложение с модульной архитектурой, частично основанной на микросервисах. Она состоит из нескольких модулей, каждый из которых может быть написан на разных языках программирования. Эти модули выполняют различные функции и обмениваются информацией друг с другом, используя сокеты.

На момент написания этой документации у Авроры имеются (или находятся в разработке) следующие модули:
- **GUI (графический интерфейс пользователя)**: Этот модуль отвечает за создание окон, иконок в трее и отображение сообщений на экране.
- **Voice recognition (распознавание речи)**: Этот модуль отвечает за распознавание речи пользователя.
- **Voice synthesis (синтез речи)**: Этот модуль отвечает за синтез речи Авроры.
- **Commands (обработка команд)**: Этот модуль анализирует запросы пользователя и выполняет соответствующие команды.
- **Update (обновление приложения)**: Этот модуль отвечает за обновление приложения.

![Requests](/style/img/requests.png)

## Система запросов и сокетов

Система запросов, основанная на сокетах, является ключевой частью функционирования Авроры. Без нее приложение просто не сможет работать. В этом разделе будет описан принцип работы системы, приведены примеры кода и описаны функций для взаимодействия с ней.

Также стоит упомянуть сервер, хотя пока что мы не будем уделять ему особого внимания, поскольку это не так важно. Суть сервера заключается в том, чтобы принимать запросы от клиентов и передавать их всем остальным клиентам, за исключением отправителя.

Основные термины:
- Запрос, или же сообщение. Это пакет с информацией, который один клиент хочет передать другому. Пример: чаты в мессенджерах
- Клиент, это приложение которое подключается к серверу по определённому адресу и обменивается информацией с другими клиентами.
- Сервер, это приложение которое занимает определённый адрес, прослушивает его на события (подключение клиентов или отправка запросов) и выполняет определённые действия с ними

### Как работают запросы

Для того чтобы отправить запрос, клиент должен сначала подключиться к серверу и затем вызвать специальную функцию, о которой будет рассказано позже. После установления соединения клиент отправляет запрос серверу, который рассылает его всем остальным клиентам, кроме отправителя. Затем отправитель начинает прослушивать сервер и ожидает ответного запроса.

Обработка запросов происходит на стороне клиентов. Они читают все поступающие запросы и проверяют, не предназначен ли данный запрос именно им (сам процесс формирования запросов будет рассмотрен отдельно). Если запрос успешно доставлен до получателя, последний отправляет запрос что получил и выполняет нужное действие. Первоначальный клиент получает этот запрос и прекращает прослушивание, завершив свою задачу.

![request](/style/img/request.png)

### Виды клиентов

На данный момент клиенты Авроры не могут одновременно отправлять и принимать запросы. Поэтому клиенты (или точнее - функциональные возможности, которые они предоставляют) были разделены на два типа:
- **Активные клиенты**: Это те, кто инициирует обмен запросами. Они начинают процесс обмена, отправляя запросы другим клиентам, а затем ожидают ответа. Их работа состоит в следующем: отправить запрос, дождаться ответа, принять ответ и завершить. К активным клиентам относятся:
  - Voice recognition (распознавание речи)
  - Update (обновление)
- **Пассивные клиенты**: Эти клиенты только принимают запросы и реагируют на них, но не начинают обмен. Их работа состоит в следующем: ожидать запрос, принять запрос, отправить ответ и завершить. К пассивным клиентам относятся:
  - GUI (графический интерфейс пользователя)
  - Voice synthesis (синтез речи)
  - Commands (обработка команд)
 
### Клиенты и функции в коде

Теперь, когда мы понимаем, как работает вся эта система, мы можем рассмотреть код с функциями. Я не буду вдаваться в подробности реализации, для вас (и, возможно, для меня) это будет черным ящиком. Однако я объясню, как с ними взаимодействовать. Давайте начнем с настройки запуска сервера и клиентов.

Во-первых, необходимо запустить сервер, используя файл `server.py`. Затем вы можете запускать клиентов, которые будут подключаться к серверу. Для удобства тестирования используется файл `start.bat`, который запускает файлы в нужной последовательности.

> [!TIP]
> Если вы запустите только сервер и одного клиента, не дождавшись запуска второго, и первый клиент отправит запрос, то этот запрос не достигнет других клиентов и будет потерян.

#### Функция запросов

Функция запросов является основным механизмом инициализации клиента, отправки и приема запросов. Взаимодействие с сервером происходит через функцию `connect()`. Рассмотрим корректный вызов данной функции для JavaScript и Python.

**JavaScript:**
```javascript
// Импортируем функцию из файла
const connect = require('./scripts/client');

// Создаём асинхронную функцию для отправки запроса
async function main() {
    // Передаем сообщение (тут нету, поскольку пассивный) и тип клиента
    console.log(await connect({ type: "passive" }));
};

// Вызываем асинхронную функцию и обрабатываем ошибки
main().catch(err => {
    console.error(err);
});
```

**Python:**
```python
# Импортируем функцию
from scripts.client import connect
import asyncio

# Создаём асинхронную функцию для отправки запроса
async def main():
    # Передаем сообщение и тип клиента
    print(await connect(message="Hello", type="active"))

# Вызываем асинхронную функцию
asyncio.run(main())
```

Хотя это может показаться несколько сложным, это необходимо для нормального функционирования. Однако, использование самой функции запросов крайне просто. Вы просто передаёте необходимый запрос и получаете **активного клиента**, для уверенности вы можете поставить `type="active"`, но этот параметр стоит по умолчанию. 

Что касается получения **пассивного клиента**, то вам не нужно передавать ему никакие значения (это не обязательно для пассивного, обязательно требуется указать тип `type="passive"`), но вы сможете получить его из функции. Примеры:

**JavaScript:**
```javascript
async function main() {
    // Принимаем значение из функции
    const result = await connect({ type="passive" });
};
```

**Python:**
```python
async def main():
    result = await connect(type="passive")
```

#### Формирование запросов

Для успешного взаимодействия с модулями Авроры необходимо правильно составлять запросы, соответствующие определённым требованиям. В противном случае могут возникнуть ошибки и несовместимость с стандартными модулями.

Запросы отправляются и принимаются в форме массивов с незначительными изменениями. При отправке запроса вам необходимо сформировать его как строку, представленную в виде массива. Пример представления запроса:

```javascript
// Клиент который отправляет запрос
const request = 'Client 1%_Client 2%_Message';
```

Здесь символ `%_` используется в качестве разделителя для последующего преобразования в массив.

```javascript
// Клиент который отправляет запрос
const request = ['Client 1', 'Client 2', 'Message'];
```

В этом примере строка запроса была преобразована в массив с использованием разделителя `%_`. Вот что означает каждая часть запроса:
- Первый аргумент - адрес получателя, `Client 1`
- Второй аргумент - адрес отправителя, `Client 2`
- Третий аргумент - само сообщение, `Message`
